  import { csv } from "d3-fetch";
  import { event, select, selectAll } from "d3-selection";
  import { scaleBand, scaleLinear } from "d3-scale";
  import { min, max } from "d3-array";
  import { axisBottom, axisLeft } from "d3-axis";
  import { transition } from 'd3-transition';
  import enterView from 'enter-view';

  var primary_color = "#30a370";
  var background_color = "white";

  var breakpoint_l = 1550;
  var breakpoint_ml = 1199;
  var breakpoint_m = 520;


  function formatNumber (number) {
    var numstring = number.toString();
    if(numstring.length > 3) {
      var thpos = -3;
      var strgnum = numstring.slice(0, numstring.length+thpos);
      var strgspace = (" " + numstring.slice(thpos));
      numstring = strgnum + strgspace;
      return numstring;
    } else {
      return number;
    }
  }

  function drawChart () {

  var margin = {top: 75, right: window.innerWidth < breakpoint_m ? 35 : 45, bottom: 200, left: 35};

  var svg_height = 500;

  var svg = select("#bikeaccidents");
  svg.selectAll("*").remove();
  var svg_width = svg.node().parentNode.getBoundingClientRect().width;

  svg.attr("width", svg_width);
  svg.attr("height", svg_height);
  svg.style("background-color", background_color);

  var chart_width = +svg.attr("width") - margin.left - margin.right;
  var chart_height = +svg.attr("height") - margin.top - margin.bottom; 
  
  var x = scaleBand().rangeRound([0, chart_width]).padding(0.1),
  y = scaleLinear().rangeRound([chart_height, 0]);

  var g = svg.append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  csv("https://interaktiv.tageswoche.ch/2018/bikemap/public/data.csv", function(d) {
    d.anzahl = +d.anzahl;
    return d; })
  .then(function(data) {
    var max_value = max(data, function(d) { return d.anzahl; });
    x.domain(data.map(function(d) { return d.unfallart; }));
    y.domain([0, max_value]);


    var y_axis = g.append("g")
      .attr("class", "axis axis--y")
        .attr("fill", primary_color)
        .call(axisLeft(y).ticks(5)
        .tickFormat(d => formatNumber(d)));
    
    y_axis.append("g")
      .attr("class", "chart-title")
      .append("text")
      .attr("fill", primary_color)
      .attr("y", -30)
      .attr("x", 10)
      .attr("dy", "0.71em")
      .attr("text-anchor", "start")
      .text("Velounf√§lle 2017");

    var x_axis = g.append("g")
      .attr("class", "axis axis--x");

    x_axis.append("line")
      .attr("x1", -35)
      .attr("x2", chart_width)
      .attr("y1", 15)
      .attr("y2", 15)
      .attr("stroke-width", 3)
      .attr("stroke", primary_color);

    x_axis
      .attr("transform", "translate(0," + chart_height + ")")
      .call(axisBottom(x).tickPadding(20));

    var bar = g.selectAll(".bar").data(data);

    var bar_enter = bar.enter().append("g").attr("class", "bar");
    bar_enter.append("rect");

    bar_enter.append("text").attr("class", "bar-value");

    var bar_update = bar.merge(bar_enter);


    bar_update.attr("transform", function(d) {
      return "translate(" + x(d.unfallart) + ", 0 )";
    });

    bar_update.select("rect")
        .style("pointer-events", "none")
        .attr("y", chart_height)
        .attr("width", x.bandwidth())
        .attr("fill", primary_color)
        .transition()
        .delay(200)
        .duration(3000)
        .attr("y", function(d) { return y(d.anzahl); })
        .attr("height", function(d) { 
          return chart_height - y(d.anzahl); 
        })
        .on("end", function () { 
          select(this).style("pointer-events", "auto");
        });

    bar_update.select(".bar-value")
      .transition()
      .text(function(d) { return formatNumber(Math.round(d.anzahl)); })
      .style("text-anchor", "middle")
      .attr("x", x.bandwidth() / 2)
      .attr("y", function(d) {
        var offset = -5;
        return y(d.anzahl) + offset; })
      .attr("opacity",  0);

    bar_update.on("mouseenter", function (d) {
      select(this).select("rect").transition().attr("opacity", ".8");
      select(this).select(".bar-value")
        .attr("opacity", "1");
      select_axis_label(d).style("font-weight", 700);
      select_axis_label(d).select(".outer-circle").transition().attr("fill", primary_color);
    });

    bar_update.on("mouseleave", function (d) {
      select(this).select("rect").transition().attr("opacity", "1");
      select(this).select(".bar-value")
        .attr("opacity", "0");
      select_axis_label(d).style("font-weight", 400);
      select_axis_label(d).select(".outer-circle").transition().attr("fill", background_color);
    });

    var ticks = x_axis.selectAll(".tick");
    
    ticks.each(function() { select(this)
      .append("circle")
      .attr("r", 5)
      .attr("cy", 15)
      .attr("fill", primary_color)
      .attr("stroke", background_color)
      .attr("stroke-width", 1); });

    ticks.selectAll("line").remove();

    ticks.each(function() { select(this)
      .append("circle")
      .attr("class", "outer-circle")
      .attr("r", 3.5)
      .attr("cy", 15)
      .attr("fill", background_color); });


    x_axis.selectAll("text")
      .attr("class", "barchart-label")
      .attr("y", 10)
      .attr("x", -25)
      .attr("transform", "rotate(-45)")
      .style("text-anchor", "end");

    // logo and train
    var m2_logo = x_axis.append("g")
      .attr("class", "m2-logo")
      .attr("transform", "translate(-30, 15)");

    // m2_logo
    //   .append("circle")
    //   .attr("r", 15)
    //   .attr("fill", primary_color);
    
    // m2_logo
    //   .append("g")
    //   .attr("fill", background_color)
    //   .attr("transform", "translate(-12, -12)");

    // // m2_logo.select("g")
    // //   .append("polygon")
    // //   .attr("points", "6.94 7.86177778 5.46888889 7.86177778 5.46888889 3.46711111 4.028 6.32666667 3.03244444 6.32666667 1.58177778 3.46711111 1.58177778 7.86177778 0.109777778 7.86177778 0.109777778 0.323111111 1.55466667 0.323111111 3.51733333 4.39866667 5.46888889 0.323111111 6.94 0.323111111 6.94 7.86177778");
    
    // m2_logo.select("g")
    //   .append("path")
    //   .attr("d", "M19.3779762,6.33187229 C19.3126082,6.28890693 19.2469156,6.24626623 19.1809524,6.20373377 C19.1150433,6.1612013 19.0487013,6.11899351 18.983171,6.07581169 C18.715368,5.89924242 18.4558442,5.71011905 18.2084416,5.50584416 C17.9284091,5.27467532 17.6803571,5.01801948 17.4242424,4.76195887 C16.3419913,3.51737013 15.5844156,2.00221861 14.0824675,1.25692641 C13.7299784,1.09063853 13.3676948,0.958874459 12.9975108,0.858658009 C11.8870671,0.5629329 10.7060065,0.551406926 9.45010823,0.973214286 C8.95124459,1.10703463 8.46185065,1.27305195 7.98544372,1.47040043 C6.55622294,2.06239177 5.24372294,2.93609307 4.11688312,4.0629329 C1.86325758,6.31650433 0.622132035,9.31287879 0.622132035,12.5 C0.622132035,15.6871212 1.86331169,18.6834957 4.11693723,20.9371753 C6.37056277,23.190855 9.36699134,24.4319805 12.5541126,24.4319805 C15.7412338,24.4319805 18.7376082,23.1908009 20.9912879,20.9371753 C22.1181277,19.8103355 22.991829,18.4978355 23.5838203,17.0686688 C23.7811688,16.5922619 23.9470238,16.1029221 24.0743506,15.6060606 C24.3505411,14.6694805 24.412013,13.6795996 24.2805736,12.7133117 C24.1503788,11.7560606 23.8375,10.8281926 23.3977273,9.96964286 C23.2035714,9.5905303 22.9991342,9.21017316 22.7280303,8.87981602 C22.4135281,8.49659091 22.0318182,8.20968615 21.6444264,7.90692641 C21.5904221,7.86471861 21.5362013,7.82267316 21.4819805,7.78068182 C21.4277056,7.73874459 21.3734307,7.69680736 21.3191558,7.65487013 C20.7792208,7.25108225 20.1839827,6.87229437 19.6260281,6.49485931 C19.5435606,6.4405303 19.4607684,6.38625541 19.3779762,6.33187229 Z M22.9536255,12.1324675 C20.8874459,12.1212121 18.8311688,12.012987 16.8290043,11.7965368 C17.0725108,11.6522186 17.312987,11.4989177 17.5522727,11.341342 C17.7915043,11.1837662 18.0418831,11.0226732 18.2900433,10.8766234 C19.2779762,10.2952922 20.1655303,9.61141775 21.265368,9.25384199 C21.4858766,9.18214286 21.6585498,9.36147186 21.822619,9.63138528 C21.9866883,9.9012987 22.138961,10.2518398 22.308171,10.4928571 C22.5904221,11.0099567 22.8085498,11.5574134 22.9536255,12.1324675 Z M21.1504329,8.8737013 C20.1298701,9.52380952 19.1558442,10.2813853 18.1036797,10.8702381 C17.8391234,11.0207251 17.5700758,11.1621212 17.2949675,11.2906926 C17.0199134,11.4192641 16.7387987,11.5350108 16.4502165,11.6341991 C15.9632035,11.7965368 15.3138528,11.4718615 14.7186147,11.4177489 C14.7997835,11.1742424 14.8674242,10.8766234 14.9553571,10.6195887 C15.04329,10.3625541 15.1515152,10.1461039 15.3132035,10.0655844 C16.7568182,9.34350649 18.3708874,9.13501082 19.8073593,8.4702381 C19.897132,8.42867965 19.9862013,8.3853355 20.074513,8.34004329 C20.1839827,8.27922078 20.2922078,8.17099567 20.4811688,8.30059524 C20.5286797,8.33555195 20.5756494,8.3711039 20.6220238,8.40730519 C20.8076299,8.5521645 20.984145,8.70730519 21.1504329,8.8737013 Z M14.2332792,12.0619589 C13.9069264,11.9588745 13.9069264,11.7424242 13.8528139,11.4177489 C14.0151515,11.525974 14.2857143,11.4177489 14.4357684,11.5330087 L14.2332792,12.0619589 Z M14.3465368,12.3597403 L14.8749459,12.7291667 L14.3820346,13.0536255 L14.2027056,12.7345238 L14.3465368,12.3597403 Z M13.8113636,11.2194264 C13.3658009,10.3354978 14.3398268,10.2813853 14.9891775,10.0649351 C14.8268398,10.4978355 14.6645022,10.9307359 14.501461,11.3613095 L13.8113636,11.2194264 Z M13.983171,13.5925866 C14.3398268,13.2034632 14.5021645,13.5281385 14.6645022,13.9069264 C14.4480519,13.8528139 14.1774892,14.0151515 13.9781385,13.949513 L13.983171,13.5925866 Z M14.7477273,14.1123377 C15.04329,14.6645022 15.2597403,15.2056277 15.5844156,15.6926407 C14.8809524,15.3138528 13.6904762,15.2056277 13.9733766,14.1621212 L14.7477273,14.1123377 Z M14.4879329,13.2420996 C15.1515152,12.4458874 15.9090909,13.5281385 16.5584416,13.8528139 C16.017316,13.8528139 15.4220779,13.8528139 14.855303,13.8991883 L14.4879329,13.2420996 Z M15.0362554,12.6258658 C14.5021645,12.4458874 14.1774892,11.9047619 14.7186147,11.6341991 C15.1515152,11.4718615 15.7467532,11.8506494 16.2731602,11.8707792 L15.0362554,12.6258658 Z M20.1681818,8.09145022 C20.0858225,8.13690476 20.0028139,8.18106061 19.9188312,8.22440476 C19.8348485,8.26774892 19.7499459,8.31028139 19.6645022,8.35162338 C18.2966991,9.01341991 16.8109848,9.35546537 15.3679654,9.74031385 C15.8008658,8.44161255 16.3961039,7.19702381 16.9372294,5.95243506 C17.4675325,6.40698052 18.0243506,6.80849567 18.6095779,7.16623377 C18.6931818,7.21731602 18.7773268,7.26753247 18.8616883,7.31731602 C19.2099567,7.57575758 19.5887446,7.73809524 19.9707251,7.97029221 C20.037013,8.01028139 20.1029221,8.05059524 20.1681818,8.09145022 Z M16.829329,5.81428571 C16.1796537,7.08874459 15.8549784,8.54978355 14.9886905,9.79491342 C14.8809524,9.92970779 14.6645022,10.0243506 14.4142316,10.0987554 C14.163961,10.1731602 13.8798701,10.2272727 13.6363636,10.2813853 C13.5822511,9.98376623 13.4875541,9.65909091 13.4266775,9.35470779 C13.3658009,9.05032468 13.3387446,8.76623377 13.4198593,8.54989177 C13.961039,7.08874459 15.1515152,6.06060606 16.0450758,4.88511905 C16.3037338,5.2034632 16.5645563,5.51525974 16.829329,5.81428571 Z M12.7050866,10.6109848 C12.4458874,10.7683983 12.2294372,10.6601732 12.012987,10.4978355 C12.1212121,10.3354978 12.2294372,10.1731602 12.3109307,10.0378247 L12.7050866,10.6109848 Z M12.4151515,9.87813853 C12.6623377,9.52380952 12.9329004,9.09090909 13.2034632,8.71212121 C13.1493506,9.41558442 13.9069264,10.4437229 12.8751623,10.5477814 L12.4151515,9.87813853 Z M11.8302489,10.3893939 C10.7683983,10.1731602 11.2554113,9.09090909 11.2012987,8.33333333 C11.525974,8.82034632 11.8506494,9.30735931 12.1822511,9.84648268 L11.8302489,10.3893939 Z M11.726461,10.5508117 C11.6341991,10.8225108 11.3095238,10.9307359 11.1471861,10.7683983 C10.9848485,10.7142857 11.2012987,10.4437229 11.1364719,10.2252165 L11.726461,10.5508117 Z M11.8370671,14.6522727 L12.303355,15.3200758 L11.3011905,16.7584416 L11.1482143,14.9758117 L11.8370671,14.6522727 Z M11.1285173,14.7459416 L11.0687229,14.0514069 C11.4177489,13.961039 11.5800866,14.2316017 11.7110931,14.4720779 L11.1285173,14.7459416 Z M12.0345779,14.5587121 C12.2835498,14.3939394 12.6082251,14.3398268 12.7164502,14.6103896 C12.7705628,14.7727273 12.5,14.9350649 12.4348485,15.1306818 L12.0345779,14.5587121 Z M12.991829,14.6943723 L13.7255952,15.0400974 L13.5910173,16.7873377 L12.5670455,15.3199134 L12.991829,14.6943723 Z M13.1104978,14.5146645 C13.2034632,14.2316017 13.5281385,14.0692641 13.6904762,14.2316017 C13.7987013,14.3398268 13.7445887,14.6103896 13.7377706,14.8111472 L13.1104978,14.5146645 Z M12.5285173,13.7991883 C11.8277056,13.7975649 11.2466991,13.2160173 11.2318182,12.4996212 C11.2107684,11.7874459 11.7319264,11.2362013 12.3863636,11.2885281 C13.0408009,11.340855 13.61921,11.9241342 13.6796537,12.5909091 C13.7400433,13.2576299 13.2219156,13.8062229 12.5285173,13.7991883 Z M13.2767857,11.1100108 L13.0012446,10.726461 L13.4962662,10.5500541 L13.612987,11.1785714 L13.2767857,11.1100108 Z M15.9047078,4.70102814 C14.9891775,5.79004329 14.1233766,6.98051948 13.3116883,8.17099567 C13.0446429,6.19464286 13.0411255,4.16666667 13.0411255,2.11038961 C13.961039,2.43506494 14.6645022,3.08441558 15.2719697,3.86282468 C15.4871753,4.13425325 15.6975649,4.41525974 15.9047078,4.70102814 Z M12.3266775,1.95643939 C12.5,2.0021645 12.7705628,2.0021645 12.7705628,2.05627706 C12.797619,2.40800866 12.8297619,2.75936147 12.8469697,3.11158009 C12.9329004,4.87012987 13.0411255,6.65584416 13.0411255,8.38744589 C13.0411255,8.6038961 12.9193723,8.82034632 12.7637987,9.03679654 C12.6082251,9.25324675 12.4188312,9.46969697 12.2835498,9.68614719 C11.9588745,9.09090909 11.3636364,8.6038961 11.3095238,8.00865801 C11.1471861,5.95238095 11.525974,3.95021645 11.804329,1.88641775 C11.978842,1.90238095 12.1531385,1.92516234 12.3266775,1.95643939 Z M11.608658,1.87261905 C11.3095238,3.84199134 11.2012987,5.79004329 11.038961,7.73809524 C10.0738636,6.07830087 8.71212121,4.43722944 8.00865801,2.75974026 C8.33333333,2.48917749 8.98268398,2.27272727 9.72169913,2.08652597 C10.3530303,1.92164502 10.9819264,1.85124459 11.608658,1.87261905 Z M7.68046537,2.86883117 C7.68046537,2.86883117 7.91190476,3.17830087 8.23268398,3.66049784 C9.25324675,5.19480519 10.0108225,6.38528139 10.9307359,8.06277056 C11.187013,8.53008658 11.038961,9.25324675 10.9307359,9.9025974 C10.3896104,9.52380952 9.63203463,9.46969697 9.25324675,8.87445887 C8.71212121,8.06277056 8.38744589,7.14285714 7.96147186,6.24383117 C7.6362013,5.54848485 7.30984848,4.85292208 7.06515152,4.33122294 C6.82045455,3.80952381 6.65725108,3.46179654 6.65725108,3.46179654 C6.98641775,3.24626623 7.32775974,3.04805195 7.68046537,2.86883117 Z M10.3958333,12.8030844 L9.86866883,12.4350649 L10.4304654,12.0349567 L10.5902597,12.3724567 L10.3958333,12.8030844 Z M10.788961,13.3406385 L10.8311147,13.8139069 L10.1892857,13.7593074 L10.4839286,13.1277597 L10.788961,13.3406385 Z M9.67965368,12.3033009 L8.24161255,11.3011905 L10.0112013,11.1466991 L10.3363636,11.8360931 L9.67965368,12.3033009 Z M9.68003247,12.5672078 L10.3040584,13.0022727 L9.95941558,13.7397186 L8.21266234,13.5910173 L9.68003247,12.5672078 Z M10.0914502,13.9682359 L10.8500541,14.0328463 L10.9196429,14.8439394 L9.33257576,15.5885281 L10.0914502,13.9682359 Z M10.8777056,11.4432359 L10.509632,11.7106602 L10.2339286,11.1274351 L10.8965368,11.0762446 L10.8777056,11.4432359 Z M10.1356061,10.9186147 C9.84848485,10.3896104 9.63203463,9.84848485 9.41558442,9.30735931 C10.0108225,9.84848485 11.2012987,9.84848485 10.9070346,10.8608225 L10.1356061,10.9186147 Z M6.47516234,3.58333333 C6.47516234,3.58333333 6.63057359,3.91455628 6.86363636,4.41136364 C7.09669913,4.908171 7.40746753,5.57061688 7.71801948,6.23306277 C8.11688312,7.08874459 8.495671,7.95454545 8.92857143,8.82034632 C8.6038961,8.82034632 8.38744589,8.54978355 8.13068182,8.49410173 C7.63452381,8.26136364 6.9711039,7.95064935 6.30768398,7.63993506 C4.98084416,7.01850649 3.65400433,6.39713203 3.65400433,6.39713203 C4.41260823,5.29437229 5.37029221,4.33896104 6.47516234,3.58333333 Z M3.53181818,6.5788961 C3.53181818,6.5788961 4.92510823,7.23143939 6.31845238,7.88398268 C7.0150974,8.21028139 7.71179654,8.53652597 8.23387446,8.78116883 C9.25324675,8.98268398 9.52380952,10.0649351 9.91298701,10.9378247 L7.96396104,11.1077381 L2.93436147,7.60340909 C3.11488095,7.25016234 3.31482684,6.90844156 3.53181818,6.5788961 Z M2.83690476,7.79929654 L7.62689394,11.1366883 L1.79301948,11.6372835 C1.90151515,10.271158 2.26536797,8.97591991 2.83690476,7.79929654 Z M1.75849567,12.5 C1.75849567,12.283658 1.76563853,12.0689935 1.77824675,11.85579 L7.90449134,11.3300866 L9.49074675,12.4352814 L7.87554113,13.5622294 L1.77207792,13.0425866 C1.76314935,12.8628788 1.75849567,12.6819805 1.75849567,12.5 Z M1.78566017,13.261039 L7.59805195,13.7558983 L2.79301948,17.1084957 C2.23306277,15.9272186 1.88143939,14.6289502 1.78566017,13.261039 Z M2.88901515,17.3054654 L7.93517316,13.784632 L9.86158009,13.9486472 L9.0262987,15.7321429 L3.4758658,18.3361472 C3.26201299,18.0046537 3.06623377,17.6604437 2.88901515,17.3054654 Z M3.59621212,18.5187771 L8.88284632,16.0385823 L6.39134199,21.3584416 C5.29393939,20.5926948 4.34453463,19.6289502 3.59621212,18.5187771 Z M6.57229437,21.4823052 L9.18906926,15.8949134 L10.9393398,15.0737554 L11.1077381,17.036039 L7.59020563,22.084632 C7.2392316,21.9021104 6.89951299,21.7009199 6.57229437,21.4823052 Z M7.78522727,22.1833333 L11.1366883,17.3731602 L11.6415584,23.25671 C10.267316,23.1410714 8.96569264,22.7670455 7.78522727,22.1833333 Z M12.5541126,23.2956169 C12.3209416,23.2956169 12.0897186,23.2873377 11.8601732,23.2726732 L11.3301407,17.0954545 L12.4353355,15.5091991 L13.5623377,17.1244589 L13.0378788,23.2842532 C12.8774351,23.291342 12.7162879,23.2956169 12.5541126,23.2956169 Z M13.2561147,23.2721861 L13.7558983,17.4020022 L17.1502165,22.2668831 C15.955303,22.8314935 14.6409091,23.1828463 13.2561147,23.2721861 Z M17.3474567,22.171158 L13.7846861,17.0648268 L13.9338745,15.1380952 C14.7727273,15.530303 15.8549784,15.7467532 16.1436147,16.8516234 C16.3912338,17.3785173 16.7207251,18.0808983 17.0502165,18.7832251 C17.7092532,20.187987 18.36829,21.5926948 18.36829,21.5926948 C18.0398268,21.8034632 17.6988095,21.9962662 17.3474567,22.171158 Z M18.5509199,21.4724026 C18.5509199,21.4724026 17.9228355,20.1336039 17.2947511,18.7948593 C16.9807359,18.125487 16.6666667,17.4560606 16.4308442,16.9539502 C16.2878788,16.6666667 16.1796537,16.3961039 16.0714286,16.1255411 C16.9372294,16.5584416 17.8571429,16.9372294 18.7328463,17.3792208 C19.4067641,17.694697 20.0803571,18.0101732 20.5856061,18.2468074 C21.0908009,18.4834416 21.4276515,18.6411797 21.4276515,18.6411797 C20.6544372,19.7548701 19.6775974,20.7168831 18.5509199,21.4724026 Z M21.5508658,18.4598485 C21.5508658,18.4598485 21.1973485,18.2942641 20.6670996,18.0459416 C20.1368506,17.797619 19.4298701,17.4665043 18.7204545,17.1353355 C17.7489177,16.7207792 16.7207792,16.3961039 15.9090909,15.7467532 C15.4761905,15.3679654 15.3138528,14.6645022 14.9891775,14.1233766 C15.5844156,14.0692641 16.2878788,13.9069264 16.7748918,14.0692641 C18.452381,14.7727273 19.8593074,15.9090909 21.3461039,16.8957792 C21.8257576,17.2294372 22.1450758,17.4519481 22.1450758,17.4519481 C21.9649351,17.7993506 21.766342,18.1356602 21.5508658,18.4598485 Z M22.2435065,17.25671 C20.6168831,16.1255411 18.8852814,15.04329 17.1536797,14.0151515 C19.1558442,13.9069264 21.1580087,13.6904762 23.1601732,13.5281385 C23.1060606,14.1774892 23.1060606,14.8268398 22.9262987,15.3972403 C22.7718074,16.033658 22.5375541,16.659632 22.2435065,17.25671 Z M16.8653139,13.8175325 C16.2878788,13.474026 15.8008658,13.0952381 15.2056277,12.7705628 C15.6926407,12.5 16.1255411,11.9588745 16.6125541,12.012987 C18.7229437,12.1212121 20.8333333,12.0670996 22.9978355,12.4458874 C23.1060606,12.4458874 23.1601732,13.2034632 23.0519481,13.2034632 C21.3744589,13.7445887 19.5887446,13.6363636 17.8042749,13.7762446 C17.2384199,13.8027597 16.8653139,13.8175325 16.8653139,13.8175325 Z")
    //   .style("display", "block");

    var metro_train = x_axis.append("g")
      .attr("class", "metro-train")
      .attr("fill", primary_color)
      .attr("transform", "translate(0, -10)");

    metro_train.append("path")
      .style("display", "block")
      .attr("d", "M26.725,14.26 L26.525,13.525 C26.4,13.045 26.685,12.55 27.165,12.42 C27.64,12.295 28.135,12.58 28.265,13.06 L28.445,13.725 C28.785,13.67 29.135,13.64 29.495,13.64 C33.085,13.64 36,16.555 36,20.145 C36,23.735 33.085,26.65 29.495,26.65 C25.905,26.65 22.99,23.735 22.99,20.145 C22.99,17.545 24.52,15.3 26.725,14.26 L26.725,14.26 Z M15.425,21.045 C14.985,24.21 12.25,26.65 8.945,26.65 C5.335,26.65 2.4,23.735 2.4,20.145 C2.4,16.555 5.335,13.64 8.945,13.64 C12.25,13.64 14.985,16.08 15.425,19.245 L15.9,19.245 C16.395,19.245 16.8,19.65 16.8,20.145 C16.8,20.64 16.395,21.045 15.9,21.045 L15.425,21.045 Z M27.155,15.865 C25.64,16.695 24.615,18.3 24.615,20.145 C24.615,22.84 26.805,25.025 29.495,25.025 C32.19,25.025 34.375,22.84 34.375,20.145 C34.375,17.455 32.19,15.265 29.495,15.265 C29.285,15.265 29.075,15.28 28.87,15.305 L30.155,20.115 C30.285,20.595 30,21.09 29.52,21.22 C29.04,21.35 28.545,21.065 28.42,20.585 L27.155,15.865 Z M13.77,19.245 C13.345,16.98 11.345,15.265 8.945,15.265 C6.235,15.265 4.035,17.455 4.035,20.145 C4.035,22.84 6.235,25.025 8.945,25.025 C11.345,25.025 13.345,23.31 13.77,21.045 L8.7,21.045 C8.205,21.045 7.8,20.64 7.8,20.145 C7.8,19.65 8.205,19.245 8.7,19.245 L13.77,19.245 Z M10.245,10.875 C10.24,10.46 10.455,10.05 10.845,9.825 L19.74,4.69 C20.27,4.385 20.94,4.53 21.3,5.01 C21.415,5.145 21.505,5.31 21.555,5.49 L22.72,9.84 L27.075,9.84 C27.74,9.84 28.28,10.38 28.28,11.045 C28.28,11.71 27.74,12.25 27.075,12.25 L21.795,12.25 C21.22,12.25 20.735,11.845 20.62,11.3 C20.61,11.27 20.6,11.24 20.59,11.21 L19.605,7.535 L13.825,10.875 L21.95,15.57 C22.205,15.715 22.385,15.94 22.48,16.2 C22.625,16.535 22.615,16.93 22.415,17.275 L18.755,23.62 C18.42,24.195 17.685,24.39 17.115,24.06 C16.54,23.725 16.345,22.995 16.675,22.42 L19.76,17.075 L10.845,11.93 C10.455,11.705 10.24,11.295 10.245,10.875 L10.245,10.875 Z M23.7,1.75 C24.86,1.75 25.8,2.69 25.8,3.85 C25.8,5.01 24.86,5.95 23.7,5.95 C22.54,5.95 21.6,5.01 21.6,3.85 C21.6,2.69 22.54,1.75 23.7,1.75 L23.7,1.75 Z");
    
    metro_train.transition()
      .style('opacity', 1)
      .delay(200)
      .duration(3000)
      .attr("transform", "translate(" + chart_width + ", -10)");
      
      svg.style("opacity", 1).style("pointer-events", "auto");


    function select_axis_label(datum) {
      return x_axis.selectAll('.tick')
      .filter(function(x) {
        return x == datum.station; });
    }

  });
}

const bikewrapper = select('#bikewrapper');

function init() {

  enterView({
    selector: bikewrapper.nodes(),
    offset: 0.3,
    enter: el => {
      drawChart(el);
    },
    once: true
  });
}

init();

function reDraw () {
  drawChart();
}

window.addEventListener('resize', reDraw);

if (window.innerWidth < 768) window.removeEventListener('resize', reDraw);